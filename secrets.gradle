def getLocalSecret(String secretName) {
    String keyConfigPath = "${projectDir.path}/secret.properties"
    File keyConfigFile = file(keyConfigPath)
    if (keyConfigFile.exists()) {
        def Properties props = new Properties()
        props.load(keyConfigFile.newInputStream())
        String prop = props[secretName]
        if (prop == null || prop.isEmpty()) {
            throw new MissingPropertyException("Missing property $secretName")
        } else {
            return prop
        }
    } else {
        throw new FileNotFoundException("File $keyConfigPath not found")
    }
}

def loadSecret(String envVarName, String secretName) {
    return (System.getenv(envVarName) ?: getLocalSecret(secretName))
}

ext {
    loadSecret = this.&loadSecret
}